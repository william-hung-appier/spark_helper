# Time Validation UX Fix

## Context/Background

- Time validation on blur was preventing users from continuing to type after an error appeared
- When pressing Tab from startTime to endTime, the error message appearing caused focus to be lost
- Error messages remained visible even after the user started correcting the input

## AS-IS (Before v2.4.1)

1. Pressing Tab from startTime to endTime triggers blur validation immediately
2. Error message appears synchronously, causing DOM changes during focus transition
3. Focus is lost (no cursor visible) - user cannot type in endTime
4. Error message stays visible even when user clicks back and starts typing

## TO-BE (v2.4.1 Implementation)

1. Validation is deferred using `setTimeout(0)` to allow focus transition to complete
2. Validation is skipped when focus moves between startTime and endTime (user is still filling the form)
3. Error message clears immediately when user starts typing in either time input
4. Code refactored to eliminate duplication between standard and quick query modes

## Implementation Details

### Deferred Validation

Validation now runs after the focus transition completes, preventing DOM changes from interfering with Tab navigation:

```javascript
function validateTimeOnBlur() {
  setTimeout(() => {
    // Validation runs after focus has settled
  }, 0);
}
```

### Smart Skip Between Time Inputs

When user Tabs from startTime to endTime (or vice versa), no error is shown since they're still filling in the time range:

```javascript
const activeElement = document.activeElement;
if (activeElement === startInput || activeElement === endInput) {
  hideError();
  return; // Skip validation
}
```

### Clear Error on Typing

Error message disappears immediately when user starts typing, providing instant feedback:

```javascript
startInput.addEventListener("input", hideError);
endInput.addEventListener("input", hideError);
```

### Code Refactoring

Eliminated code duplication by extracting reusable helper functions:

| Function                                                           | Purpose                                                                       |
|--------------------------------------------------------------------|-------------------------------------------------------------------------------|
| `createTimeValidator(config)`                                      | Factory function that creates a validation handler for any time input pair   |
| `attachTimeValidation(startInput, endInput, showError, hideError)` | Sets up all event listeners (blur + input) for a time input pair             |

Before: ~50 lines of duplicated code for standard vs quick query modes
After: Single reusable implementation with 2 configuration calls

## Acceptance Criteria

- [x] User can Tab from startTime to endTime without losing focus
- [x] No error appears when moving between time inputs
- [x] Error only appears when leaving the time input group entirely with incomplete data
- [x] Error clears immediately when user starts typing
- [x] Both standard mode and quick query mode behave consistently
- [x] All existing validation rules still apply when generating query

## Files Changed

| File             | Changes                                                                                                                                                    |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `src/js/app.js`  | Refactored time validation with `createTimeValidator()` and `attachTimeValidation()` helpers, added input event listeners for immediate error clearing    |
